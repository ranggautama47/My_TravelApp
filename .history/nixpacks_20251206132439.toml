# ============================
# Nixpacks Config for Railway
# Laravel Octane (Swoole)
# + Redis Extension
# ============================

[phases.setup]
# Install PHP 8.2 + Swoole + Redis extension
nixPkgs = [
  "php82",
  "php82Extensions.swoole",
  "php82Extensions.redis"
]

[phases.install]
# Install composer dependencies (production)
cmds = [
  "composer install --no-dev --optimize-autoloader"
]

[phases.build]
# Cache optimizations for Laravel
cmds = [
  "php artisan config:cache",
  "php artisan route:cache",
  "php artisan view:cache"
]

[start]
# Start Laravel Octane with Swoole
cmd = "php artisan octane:start --server=swoole --host=0.0.0.0 --port=${PORT}"
